<div class="related">
  <h2>Related Posts</h2>
  {% assign related_posts = site.posts | where_exp: "post", "post.tags contains page.tags.first" %}
  {% assign related_posts = related_posts | where_exp: "post", "post.title != page.title" %}
  {% if related_posts.size == 0 %}
    {% assign related_posts = site.posts | sort: 'date' | reverse | limit: 2 %}
  {% endif %}
  {% for post in related_posts limit:2 %}
    {% include post-preview.html %}
  {% endfor %}
</div>